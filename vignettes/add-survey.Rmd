---
title: "Add Surveys"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{add-survey}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(taskdesignr)
```

# Introduction {#introduction}

Many experimental tasks require some type of survey. A clear example is a simple demographic form. Our package allows you to easily create questionnaires using Shiny.[^1] We provide two functions to do this: `surveyUI()` and `surveyServer()`. To illustrate them in use, we will create a questionnaire from McGowan et al (2021). These questions, build into the taskdesignr package, follow a specific format:

[^1]: We assume that you are familiar with the basic layout of a Shiny application. If not, please check out RStudio's [great resources](https://shiny.rstudio.com/tutorial/) before completing this vignette.

```{r, echo = FALSE}
taskdesignr::teaching_r_questions
```

As seen, this is a tidy data frame, where each row is a unique observation and each column is a variable. While there are 54 rows, there are only 11 unique questions:

```{r display unique questions}
unique(taskdesignr::teaching_r_questions$question)
```

Each question has seven variables that dictate how it functions within the survey. They are described in the data set documentation, accessed by calling `?taskdesignr::teaching_r_questions` in your console, as follows:

-   *question*: The question to be asked.
-   *option*: A possible response to the question. In multiple choice questions, for example, this would be the possible answers. For questions without discrete answers, such as a numeric input, this would be the default option shown on the input.
-   *input\_type*: What type of response is expected? Currently supported types include `numeric`, `mc` for multiple choice, `text`, `select`,and `y/n` for yes/no questions.
-   *input\_id*: The input id for Shiny inputs.
-   *dependence*: Does this question (row) depend on another? That is, should it only appear if a different question has a specific value? This column contains the input\_id of whatever question this one depends upon.
-   *dependence\_value*: This column contains the specific value that the dependence question must take for this question (row) to be shown.
-   *required*: logical TRUE/FALSE signifying if a question is required.

# Examples

Below are examples of the currently supported question types. We provide a thorough explanation for the numeric input, but only point out notable differences for other inputs.

## Numeric Input

A good example of a numeric input is the first question: "What's your age?":

```{r what is your age preview, echo = FALSE}
taskdesignr::teaching_r_questions %>%
  dplyr::filter(input_id == "age")
```

As we noted in the [introduction](#Introduction), this row shows us that the question is "What's your age?". We know we are expecting a numeric input by looking at the `input_type` column, and the default value is equal to 25 according to the `option` column.

> It is important to note that the `option` column for numeric inputs provides the default value, but for other types -- as we will see -- provides the possible options for a question.

We can also tell that there are no dependency questions. This means that no matter what value you enter, no follow-up question will appear. Lastly, we know this is a required question.

![Numeric input example](images/Screen Shot 2020-10-17 at 8.34.02 PM.png){width="300"}

## Multiple Choice (mc) Input {#multiple_choice}

An example of this is the question "Which best describes your gender?":

```{r what is your gender mc, echo = FALSE}
taskdesignr::teaching_r_questions %>%
  dplyr::filter(input_id == "gender" | input_id == "self_describe_gender")
```

Unlike numeric inputs, the `option` column represents each of the possible responses for this question. You may notice that the fifth row of this question has *NA* in the `option` column and "text" in the `input_type` column. We will discuss this in more detail [below](#Question Dependencies), but for now note that this question has a dependent. That is, if a specific option is chosen for this question, a new one will appear below. In this case, a question that accepts text as its input.

![Multiple Choice Example](images/Screen Shot 2020-10-17 at 8.34.57 PM.png){width="300"}

## Text Input {#text_input}

Questions that need text-based input should specify "text" in the `input_type` column. As noted in the previous example, the following is a dependent of the question "Which best describes your gender?":

```{r what is your gender text, echo = FALSE}
taskdesignr::teaching_r_questions %>%
  dplyr::filter(input_id == "self_describe_gender")
```

It's important to note that the `option` column for text-based inputs can be left blank (i.e. NA) or contain a character string. If they are left empty, the text field will display "Placeholder." Otherwise, the character string will be displayed:

![Text input placeholder](images/Screen Shot 2020-10-17 at 8.17.58 PM.png){width="381"}

![Text input character string](images/Screen Shot 2020-10-17 at 8.19.33 PM.png){width="381" height="90"}

## Select Input

Select inputs are great when there are many potential, discretely defined, response choices.[^2] An example is the question "What was your first language?" contains `r teaching_r_questions %>% dplyr::filter(question == "What was your first language?") %>% dplyr::count()` rows because there are that many options to choose from:[^3]

[^2]: As of October 2020, these do not support multiple options selected at once, though we anticipate adding this functionality in the future.

[^3]: Note the presence of the NA in the output above. This deals with question dependencies, which is explained in detail in the section [Question Dependencies](\#Question Dependencies).

```{r show first language options, echo = FALSE}
taskdesignr::teaching_r_questions %>%
  dplyr::filter(question == "What was your first language?") %>%
  dplyr::pull(option)
```

![Select input example](images/Screen Shot 2020-10-17 at 8.35.58 PM.png){width="300"}

## Yes or No (y/n) Input

Yes or no questions are self-explanatory. An example is the question "Have you ever learned to program in R?":

```{r learned to program in R, echo = FALSE}
taskdesignr::teaching_r_questions %>%
  dplyr::filter(input_id == "learned_r")
```

![Yes or No (y/n) input example](images/Screen Shot 2020-10-17 at 8.36.38 PM.png){width="300"}

# Question Dependencies

We use the term question dependencies in reference to the situations where a question should only be shown (i.e. asked) if a specific response is given to a preceding question. The questions included with the `taskdesignr` package contain many dependencies. One example we've seen discussing [multiple choice](#multiple_choice) and [text-based](#text_input) questions is the dependent for "Which best describes your gender?"

```{r what is your gender - question dependencies, echo = FALSE}
taskdesignr::teaching_r_questions %>%
  dplyr::filter(input_id == "gender" | input_id == "self_describe_gender")
```

Focusing on the columns `dependence` and `dependence_value`, we see that the text-based question will only show if the multiple choice one, with the input id of "gender" takes on the value "Prefer to self describe." That is, a question with non *NA* values in the `dependence` and `dependence_value` columns mean that it will only show if the question with the input id from `dependence` takes on the value from `dependence_value`. This can be seen below:

![](images/Screen Shot 2020-10-17 at 8.58.48 PM.png){style="display: block; margin: 1em auto" width="300"}

![](images/Screen Shot 2020-10-17 at 8.59.02 PM.png){style="display: block; margin: 1em auto" width="300"}

# Basic Survey in Shiny

To see a survey in action, please run the following:[^4]

[^4]: By clicking submit in the Shiny app, your responses may be downloaded.

```{r run survey, eval = FALSE}
taskdesignr::demo_single_page(taskdesignr::teaching_r_questions)
```
